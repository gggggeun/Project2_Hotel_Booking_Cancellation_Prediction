# 프로젝트2 -  호텔 이용고객 분석 및 잠재적 취소 고객 예측 모델 제작

사용언어: python
생성일: 2021년 9월 6일 오전 9:56
업무포지션: 개인프로젝트
투입기간: 2021/02/22 → 2021/02/25

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled.png)

🗓️ **작업기간** : 2021.02.22 - 2021.02.25

🗓️ **수정기간** : 2021.09.28 (수정업데이트 최종)

👨‍💻 **투입인원** : 1명

📒 **주요업무** 

- 데이터 탐색 및 전처리 (결측값, 이상치 등 확인)
- 데이터 분석
- 모델 학습 및 성능 비교
- 최종 모델 성능 평가

🌱 **스킬 및 사용툴**

`Google-Colab`  `python` `Random-Forest`  `XgBoosting` `LightGBoosting`  `Visualization`  `Scklearn` `Pandas` `Numpy`   

## 1. PROJECT 소개

---

### 1) 분석 배경

관련 뉴: [https://www.hankyung.com/life/article/2020122267671](https://www.hankyung.com/life/article/2020122267671)

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%201.png)

### 2) 호텔 사업 비지니스 문제(가상)

갑작스런 코로나 집합금지 명령으로 인해 호텔의 수용인원을 제한해야해 전 세계 호텔 업계에 비상이 걸렸다. 대부분의 숙박업소는 대상 고객을 정하는 기준을 잡기도 모호해 고객의 자발적인 취소를 기대해야 하는 상황이다.

하지만 만약 어떤 예약이 취소될지 미리 알 수 있다면 어떨까? 

취소할 고객을 미리 알 수 있다면 취소하지 않을 고객들의 피해를 최소화 할 수 있으며, 앞으로 예약을 얼만큼 초과해 받는게 좋을지 예측할 수 있을 것이다.

### 3) 분석 목표

호텔 예약 수요 데이터로 잠재적 취소 고객을 예측하는 모델을 만들어 호텔의 수용인원을 조절하고 호텔과 고객의 손실을 최대한 줄이는 것을 목표로 한다. 또한 호텔 데이터를 분석하고, 고객 관리에 대한 인사이트를 얻는다.

### 4) 데이터

- Kaggle의 Hotel booking demand 데이터셋을 사용합니다.
    
    [https://www.kaggle.com/jessemostipak/hotel-booking-demand](https://www.kaggle.com/jessemostipak/hotel-booking-demand)
    
- 포르투갈에 있는 두 호텔의 PMS(Property Management System)에서 추출되어 가공된 데이터이며, 2015/7/1 - 2017/8/31의 호텔에 도착 예약 기록입니다.
- 피쳐로는 호텔유형, 도착날짜, 식사유형, 고객정보, 예약유형, 룸의 유형, 보증금 유형, 에이전트 유형, 예약변경유무, 취소유무 등이 있습니다.

### 5) Target data

해결해야할 문제는 고객의 각 예약이 취소될지 안될지 판단하는 모델을 만드는 것으로, 각 예약이 '취소됨(1)', '취소되지 않음(0)' 두 개의 클래스로 분류하는 이진 분류 문제이다.

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%202.png)

사용할 평가지표와 기준 모델을 정하기 위해서 위와 같이 타겟의 분포를 시각화하였다. 그림을 통해 알 수 있듯이, 0과 1이 약 6:4로 나름 고르게 분포되어 있으며 모든 분류 건수 중에서 분류기가 몇 개의 정답을 맞췄는지의 여부를 파악할 필요가 있기 때문에 Accuracy를 사용할 것이다. 그리고 Accuracy의 단점을 보완하기 위해 추가로 recall과 F1 Score를 사용하여 모델의 성능을 평가하려고 한다.

시계열 데이터가 아니기 때문에, 무작위로 데이터를 분리하여 훈련/검증/테스트 데이터셋을 만드는 방법을 택할 것이다.

기준 모델은 데이터를 모두 최빈 클래스인 0, 즉 모든 예약이 취소되지 않을 것이라고 예측하는 것으로, 정확도는 약 63%이다. 따라서 앞으로 우리가 만들 모델은 정확도가 약 0.63보다 높아야 학습이 잘 된 모델이라고 말할 수 있다.

## 2. 전처리

---

### 1) 이상치 처리

수치형의 피쳐들은 boxplot을 통해 시각화하여 이상치를 확인하고 처리 및 제거하였다.

- **예약일~숙박일 기간(lead_time)** : 365일을 초과한 값들은 모두 365일로 통일
- **투숙객 중 어른과 아이의 수(adults, children)** : 9명 이상 제거
- **투숙객 중 아기의 수(babies)** : 8명 이상 제거
- **하루평균요금(adr)** : 이상치는 제거하고, 0원이하의 값을 평균값으로 대체

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%203.png)

범주형 피쳐들 또한 막대그래프를 통해 시각화하여 이상치를 확인하였다.

- **예약한 방 유형(reserved_room_type), 당일에 할당된 방 유형(assigned_room_type)** : room L,P 제거

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%204.png)

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%205.png)

### 2) 정보 누수 제거

마지막 예약 현황의 값은 Check-Out, Canceled, No-Show로 레이블 데이터 정보가 담겨있다. 마지막 예약 현황 날짜 또한 레이블 정보를 포함한다. 즉, data leak가 일어날 피쳐들이기 때문에 제거하였다.

예약에 할당된 방 또한 정보 누수의 가능성이 있을 수 있다고 판단해 분석 이후 추후 제거하였다.

- 마지막 예약 현황(reservation_status)
- 마지막 예약 현황 날짜(reservation_status_date)
- 할당된 방 유형(assigned_room_type)

### 3) 결측치 처리

- 고객 중 아이인 경우(children) : 결측값을 0으로 변경
- 고객의 국적(country) : 결측값들을 모두 others로 변경
- 에이전트 코드(agent) : 결측값들은 모두 N으로 변경
- 여행사(company) : 결측값이 너무 많아 피쳐를 제거
- 도착일 주(week)의 순서값(arrival_date_week_number) : 결측값은 없지만, 도착일의 년/월/일 값을 나타내는 다른 피쳐들이 있기 때문에 제거

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%206.png)

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%207.png)

## 3. 피쳐 엔지니어링

---

그 외 피쳐들을 합치고 변환하는 등의 피쳐엔지니어링를 진행하였다.

- **도착월(arrival_date_month)** : 문자형에서 숫자형으로 변환
- **숙박 총 일수(stays_nights) 생성** : 숙박 주중일 수(stays_in_week_nights) + 숙박 주말일 수(stays_in_weekend_nights), 두 피쳐를 합쳐 새로운 피쳐 생성 후 삭제
- **취소율(cancellation_rating) 생성** : 이전에 취소했던&취소하지 않았던 이력(previous_cancellations, previous_bookings_not_canceled) 피쳐들로 취소율을 나타내는 새로운 피쳐를 생성하였다. 그리고 인사이트 발견을 위해 취소율로 고객등급을 나누었다. 취소율 = 취소안할확률/(취소할확률+취소안할확률)

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%208.png)

고객 별 취소율 등급을 지정해 등급이 낮은 고객 순으로 취소 메일을 보낼 수 있다. 또 취소등급이 높은 고객에게 알맞은 혜택과 이벤트 등을 제공함으로써 단골유치와 무분별한 예약 취소를 방지에 도움이 될 것으로 생각한다.

- **방 변경(room_changed) 생성** : 예약한 방(room_changed)과 할당된 방(assigned_room_type)이 같으면 0, 다르면1인 새로운 피쳐 생성
- **호텔 총 이용금액(total_bill) 생성** : 하루평균요금(adr)*머무른날짜(stays_nights)
- **weekday, weekend, weekday&weekend, undefined_data 피쳐 생성** : 숙박 중 주중인 날짜만 있는경우 weekday, 숙박 중 주말인 날짜만 있는 경우 weekend, 둘다 있는 경우 weekday&weekend, 모두 0인 경우 undefined data
- **예약의 총 게스트 수(total_guest) 생성** : 어른(adults) + 아이(children) + 아기(babies), 이후 어른피쳐를 삭제하고 아이+아기 피쳐를 아이(children)으로 합침. 즉, total_guest와 children으로 피쳐 축소. (중요하지 않는 피쳐이기에 모델에 영향이 거의 없음을 확인)

**피쳐 엔지니어링 완료 후 특성 정리**

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%209.png)

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%2010.png)

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%2011.png)

## 4. EDA & Visualization

---

모델을 만들기 전에 특성들을 EDA 해보았다. 만약 어떤 특성에서 취소된 예약 건과 취소되지 않은 예약 건의 분포에 차이가 있다면, 해당 특성은 각 예약이 취소될지 취소가 되지 않을지 예측하는데 도움이 되므로 분류 모델에서도 중요도가 높을 것이다. 따라서 각 특성과 타겟의 관계에 대해서 시각화하며 특성들의 특징을 파악하였다.

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%2012.png)

### 1) 상관관계 분석

상관관계가 높은 피쳐 몇 개만 추려보았다.

<레이블(is_canceled)과 상관관계가 높은 수치형 피쳐들 TOP 10>

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%2013.png)

1. 예약일-도착일 경과일수 (lead_time)
2. 과거 예약취소 개수 (previous_cancellations)
3. 예약확정까지의 예약대기 일수(days_in_waiting_list)
4. 숙박일수(stays_nights)
5. 총 게스트 수(total_guest)
6. 총 지불액(total_bill)
7. 도착년도(arrival_date_year)
8. 하루평균요금(adr)
9. 도착월(arrival_date_day_of_month)

### 2) EDA

1. **예약일-도착일 경과일수 (lead_time)**

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%2014.png)

- 호텔 예약을 성급하게한 고객일수록(lead time이 짧을수록) 취소할 확률이 매우 적고, 먼 미래에 예약한 고객일수록 예약을 취소할 확률이 높다.
- 결과가 다소 뚜렷해 예측모델에 중요한 특성임을 알 수 있다.

1. **과거 예약취소 개수 (previous_cancellations)**

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%2015.png)

- 위 그래프로 이전에 호텔 예약을 취소한 전적이 매우 많을 수록 예약을 취소할 확률이 더 높음을 알 수 있다.
- 특히 호텔을 이용한 전적보다 취소한 전적이 더 많은 사람일수록 취소할 경우가 많고, 이전에 숙박했던 고객일수록 취소하지 않을 가능성 높음을 알 수 있다.

1. **예약확정까지의 예약대기 일수(days_in_waiting_list)**

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%2016.png)

약 20일 이하의 고객의 카디널리티가 매우 높다.

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%2017.png)

그래프를 확대

- 예약대기가 짧을 경우(약 20일이하) 취소를 하지 않는 경우가 높지만, 일정 대기일이 넘어가면 예약을 취소할 확률이 높아진다(약 20일~130일). 특히 예약대기일이 약 20일~50일일 경우 취소할 확률이 매우 크다.
- 예약대기가 1년 이상일 경우 또한 취소할 확률이 크다.

## 5. 최종모델

---

### **▶ RandomForest (n_estimators=1000, n_jobs=-1, oob_score=True)**

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%2018.png)

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%2019.png)

- 머신러닝 RandomForest, XGB, LGB 모델으로 학습하고 하이퍼 파라미터 튜닝으로 모델을 개선 후 비교하였습니다.
- 정확도가 가장 높은 랜덤포레스트 모델을 사용하였고, ROC-AUC 결과도 0.95로 꽤 높아 정확한 모델이라고 볼 수 있다.

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%2020.png)

- X축은 취소하지 않은 고객을 취소했다고 예측한 비율, Y축은 취소한 고객을 취소했다고 예측한 비율이다.
- 곡선이 굽어질수록 고객의 취소율을 정확히 예측했다는 것을 알 수 있다. 또한 AUC 스코어가 1에 가까울 수록 정확한 모델이다.
- 이 모델은 AUC score가 0.8 이상이므로 꽤 정확한 모델이라고 볼 수 있다.

## 6. 테스트 및 평가

---

### 1) **TEST 모델 : 랜덤포레스트 모델**

- 정확도(Accuracy) : 89.55%
- ROC-AUC : 95.84%, Precision : 88.31%, Recall : 82.41%, f1 score : 85.26%
- 파라미터 : n_estimators=1000, n_jobs=-1, oob_score=True

### 2) **순열중요도**

이 데이터에서 취소를 예측할 때 가장 중요한 특성 5개를 살펴보면, 이 모델이 예측한 예약 취소는 국가(country), 특수요청사항(total_of_special_requests), 예약부터 도착일까지 걸리는 기간(lead time), 예치금 종류(deposit type), 에이전트(agent)의 영향을 받는다. 이렇게 나온 결과를 바탕으로 중요한 특성 위주로 모델을 학습시키면 모델의 성능을 높일 수 있을 것이다. 또한 학습한 모델을 순열중요도 결과를 모델을 설명하는 자료로 사용할 수도 있을 것이다.

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%2021.png)

### 3) **PDP** (Partial dependence plots) - 특성과 타겟의 관계 시각화

**<고객 특별 요구 개수와 예약한 날 이후 경과일의 관계>**

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%2022.png)

- 2개의 특성을 관계를 보면 lead_time이 길고 special_requests가 하나도 없을 경우 취소율이 가장 높은 것을 알 수 있다.

**<예약한 날 이후 경과일 특성>**

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%2023.png)

- lead_time 에 대한 target의 변화이다. 예약한 날로부터 경과일이 길어지면 취소율이 높아짐을 알 수 있다.

**<보증금 타입 특성>**

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%2024.png)

- 보증금이 없는경우 (2) 인 경우 취소확률이 제일 높고 보증금 환급불가(3)일 경우 두번째로 취소확률이 높다.

### 4) **SHAP** (SHapley Additive exPlanations) - 개별 예측을 설명하는 방법

**<9900번째 행의 고객이 예약을 취소하는데 영향을 준 특성>**

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%2025.png)

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B32%20-%20%E1%84%92%E1%85%A9%E1%84%90%E1%85%A6%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8C%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%A8%20%20a2598b1e20e64064b8a3224deac618c3/Untitled%2026.png)

- 이 고객은 0.95의 높은 취소 위험을 가지고 있다.
- 가장 큰 이유는 deposit_type=2 즉, 보증금 유형이 <보증금 없음> 이었기 때문이다.
- 그 외 영향을 끼친 특성으로 고객 유형, 고객 특별요구 등이 있다.

## 7. 모델의 사용과 한계

---

## 모델의 사용

- 이 모델은 호텔이 객실을 효율적으로 운영하는 데 도움이 될 것이다.
- 코로나 사유로 인한 예약취소를 제외하여도 여전히 예약률이 수용 제한을 초과할 경우, 잠재적 취소 고객을 예측해 대략 몇명의 고객에게 취소 메일을 보낼 수 있을지, 또 누구에게 보내야 하는지 판단할 수 있다.
- 코로나 상황이 아니더라도 잠재적 취소 고객을 제외하면 얼마나 더 초과예약을 받을 수 있을지 예측해 호텔 피해를 최소한으로 줄일 수 있다.
- 고객의 취소율 등급(신뢰등급) 데이터를 이용해 신뢰있는 고객을 구별하고 등급에 맞는 다양한 이벤트와 혜택을 제공해 고객유치에 힘을 쏟을 수 있다. 예를 들어 신뢰등급이 높은 고객에게 예약대기 우선권을 준다던지 , 신뢰등급이 낮은 고객 순으로 취소메일을 보내는 등
- 고객에게 신뢰등급과 그에따른 혜택을 공개하므로써 무분별한 예약취소를 방지하는데 도움이 될 것 같다.

## 모델의 한계

이 모델은 모든 호텔에서 그대로 사용할 수 없다는 한계가 있다. 특정 나라와 호텔의 데이터셋을 바탕으로 만들어진 모델이기 때문이다. 나라마다, 호텔마다 조금씩 분포가 다르게 나타날 것이기 때문에 현재 데이터 상으로는 완벽한 일반화는 불가능하다. 하지만 각 호텔의 데이터마다 비슷한 모델을 만들어 적용해 볼 수 있을 거라 생각한다.

## ⚙깃허브 링크

---

[GitHub - gggggeun/Project2_Hotel_Booking_Cancellation_Prediction](https://github.com/gggggeun/Project2_Hotel_Booking_Cancellation_Prediction)